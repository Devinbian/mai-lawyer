<view class="container">
  <bg-titlecenter-nav title="在线咨询"></bg-titlecenter-nav>
  
  <!-- 消息列表 -->
  <scroll-view 
    class="chat-content"
    scroll-y="true"
    enhanced="true"
    show-scrollbar="false"
    scroll-anchoring="true"
    scroll-into-view="{{scrollIntoView}}"
    scroll-with-animation="{{true}}"
    bindscrolltoupper="onScrollToUpper"
  >
    <view class="message-list">
      <view class="message-item {{item.isSelf ? 'self' : ''}} {{item.isSystem ? 'system' : ''}}" wx:for="{{messages}}" wx:key="id" id="msg-{{item.id}}">
        <block wx:if="{{item.isSystem}}">
          <view class="system-message">
            <text class="system-tag">{{item.content}}</text>
          </view>
        </block>
        <block wx:elif="{{!item.isSelf}}">
          <view class="avatar-wrapper">
            <image class="avatar" src="{{expert.avatar}}" mode="aspectFill"></image>
            <view class="status-dot {{expert.isOnline ? 'online' : ''}}"></view>
          </view>
          <view class="message-content">
            <text class="name">{{expert.name}}</text>
            <view class="bubble">{{item.content}}</view>
          </view>
        </block>
        <block wx:else>
          <view class="message-content">
            <view class="bubble">{{item.content}}</view>
          </view>
          <view class="avatar-wrapper">
            <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          </view>
        </block>
      </view>
    </view>
  </scroll-view>

  <!-- 底部输入框 -->
  <view class="input-wrapper {{isKeyboardShow ? 'keyboard-show' : 'keyboard-hide'}}" style="bottom: {{keyboardHeight}}px">
    <view class="input-area" style="{{inputStyle}}">
      <view class="input-box">
        <textarea 
          class="chat-input" 
          value="{{inputValue}}"
          placeholder="请输入想要问的问题" 
          placeholder-class="input-placeholder"
          adjust-position="{{false}}"
          cursor-spacing="20"
          auto-height="{{true}}"
          show-confirm-bar="{{false}}"
          maxlength="{{500}}"
          bindfocus="onInputFocus"
          bindblur="onInputBlur"
          bindinput="onInput"
          bindconfirm="sendMessage"
        />
      </view>
      <button class="send-btn" bindtap="sendMessage">
        <image class="send-icon" src="{{imgUrls.sendIcon}}" mode="widthFix" />
      </button>
    </view>
  </view>
</view> 